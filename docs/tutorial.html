

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  <title>Tutorial of pydefect &mdash; pydefect  documentation</title>
  

  
  <link href="_static/css/theme.css" rel="stylesheet" type="text/css" />
  <link href="_static/pygments.css" rel="stylesheet" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js" type="text/javascript"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script src="_static/js/theme.js" type="text/javascript"></script>

    
    <link href="genindex.html" rel="index" title="Index" />
    <link href="search.html" rel="search" title="Search" />
    <link href="first_principles_calc.html" rel="next" title="Tips for first-principles calculations for point defects" />
    <link href="index.html" rel="prev" title="Welcome to pydefect documentation!" />
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav class="wy-nav-side" data-toggle="wy-nav-shift">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a alt="Documentation Home" class="icon icon-home" href="index.html"> pydefect
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form action="search.html" class="wy-form" id="rtd-search-form" method="get">
    <input name="q" placeholder="Search docs" type="text" />
    <input name="check_keywords" type="hidden" value="yes" />
    <input name="area" type="hidden" value="default" />
  </form>
</div>

          
        </div>

        
        <div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial of pydefect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#relaxation-of-the-unit-cell">1. Relaxation of the unit cell</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calculation-of-band-dos-and-dielectric-tensor">2. Calculation of band, DOS, and dielectric tensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gathering-unitcell-information-related-to-point-defect-calculations">3. Gathering unitcell information related to point-defect calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calculation-of-competing-phases">4. Calculation of competing phases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#construction-of-a-supercell-and-defect-initial-setting-file">5. Construction of a supercell and defect initial setting file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#decision-of-interstitial-sites">6. Decision of interstitial sites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creation-of-defect-calculation-directories">7. Creation of defect calculation directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generation-of-defect-entry-json">8. Generation of defect_entry.json</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parsing-supercell-calculation-results">9. Parsing supercell calculation results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#corrections-of-defect-formation-energies-in-finite-size-supercells">10. Corrections of defect formation energies in finite-size supercells</a></li>
<li class="toctree-l2"><a class="reference internal" href="#check-defect-eigenvalues-and-band-edge-states-in-supercell-calculations">11. Check defect eigenvalues and band-edge states in supercell calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-defect-formation-energies">12. Plot defect formation energies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="first_principles_calc.html">Tips for first-principles calculations for point defects</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical_transition_level.html">Tutorial for calculation of vertical transition level</a></li>
<li class="toctree-l1"><a class="reference internal" href="change_log.html">Change log</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">

      
      <nav aria-label="top navigation" class="wy-nav-top">
        
          <i class="fa fa-bars" data-toggle="wy-nav-top"></i>
          <a href="index.html">pydefect</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div aria-label="breadcrumbs navigation" role="navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a class="icon icon-home" href="index.html"></a> &raquo;</li>
        
      <li>Tutorial of pydefect</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial-of-pydefect">
<h1>Tutorial of pydefect<a class="headerlink" href="#tutorial-of-pydefect" title="Permalink to this headline">¶</a></h1>
<p>This page illustrates how to use the <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> code.</p>
<p><strong>Note1: Pydefect now supports only the vienna ab-initio simulation package (VASP),
so we suppose its input and output file names (e.g., POSCAR, POTCAR, OUTCAR)
and computational techniques (e.g., periodic boundary condition) used in VASP.</strong></p>
<p><strong>Note2: Units used in pydefect are eV for energy and Angstrom for length
following the vasp convention.</strong></p>
<p><strong>Note3: Only nonmagnetic host materials are supposed.</strong></p>
<p>Workflow of a point-defect calculation in a non-metallic solid is shown below.
One can see some tasks are performed concurrently, while others must follow some tasks.
Usually, the processes are very intricate as shown below and time consuming
and researchers are prone to make some mistakes.
The main purpose of <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> is to provide the researchers
with automation of the point-defect calculation processes
so as to save time and reduce mistakes.</p>
<img alt="_images/flowchart.png" src="_images/flowchart.png" />
<p>Here, we suppose the following directory tree.
The <code class="code docutils literal notranslate"><span class="pre">&lt;project_name&gt;</span></code> is usually the target material name with the
crystal structure if needed, e.g., rutile-TiO<sub>2</sub>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;project_name&gt;
 │
 ├ pydefect.yaml
 ├ vise.yaml
 │
 ├ unitcell/ ── structure_opt/
 │            ├ band/
 │            └ dos/
 │
 ├ competing_phases/ ── &lt;competing_phase 1&gt;
 │                    ├── &lt;competing_phase 2&gt;
 │                    ....
 │
 └ defects/ ── perfect/
              ├─ Va_X_0/
              ├─ Va_X_1/
              ├─ Va_X_2/
             ...
</pre></div>
</div>
<p>We recommend the users to follow the same directory structure if possible.
Details of the processes are examined step by step
with an example of MgSe calculated using the PBEsol functional.</p>
<div class="section" id="relaxation-of-the-unit-cell">
<h2>1. Relaxation of the unit cell<a class="headerlink" href="#relaxation-of-the-unit-cell" title="Permalink to this headline">¶</a></h2>
<p>Point-defect calculations are generally performed at theoretically relaxed
lattice constants under the given functional and projector augmented wave (PAW) potentials,
as it avoids the artificial strain and stress
that is responsible for the unwanted supercell size dependency.
Therefore, one usually begins with optimizing lattice constants
and fractional coordinates of atomic positions in the unitcell.</p>
<p>We first prepare <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> of the pristine bulk unitcell,
and create <code class="code docutils literal notranslate"><span class="pre">unitcell/</span></code> directory and <code class="code docutils literal notranslate"><span class="pre">unitcell/structure_opt/</span></code>
sub-directory ( <code class="code docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">unitcell/structure_opt/</span></code>) and move there.
(In this tutorial, the name with <code class="code docutils literal notranslate"><span class="pre">/</span></code> at the end means a directory.)
When <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> needs to construct the vasp input files,
namely  <code class="code docutils literal notranslate"><span class="pre">INCAR</span></code>,  <code class="code docutils literal notranslate"><span class="pre">POTCAR</span></code>,  <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code> files,
we use <a class="reference external" href="https://kumagai-group.github.io/vise/">vise</a>
(= <code class="code docutils literal notranslate"><span class="pre">vasp</span> <span class="pre">integrated</span> <span class="pre">supporting</span> <span class="pre">environment</span></code>) code,
which can generate the input files for various tasks and exchange-correlation (XC) functionals.
<code class="code docutils literal notranslate"><span class="pre">Vise</span></code> relies on the <a class="reference external" href="http://pymatgen.org">pymatgen</a>, and
therefore, as shown <a class="reference external" href="https://pymatgen.org/usage.html">pymatgen web page 1</a> or
<a class="reference external" href="https://pymatgen.org/_modules/pymatgen/io/vasp/inputs.html">2</a>,
we need to set the <code class="code docutils literal notranslate"><span class="pre">PMG_DEFAULT_FUNCTIONAL</span></code> and <code class="code docutils literal notranslate"><span class="pre">PMG_VASP_PSP_DIR</span></code>
in the <code class="code docutils literal notranslate"><span class="pre">.pmgrc.yaml</span></code> file at the home directory, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PMG_DEFAULT_FUNCTIONAL</span><span class="p">:</span> <span class="n">PBE_54</span>
<span class="n">PMG_MAPI_KEY</span><span class="p">:</span> <span class="n">xxxxxxxxxxxxxxxx</span>
<span class="n">PMG_VASP_PSP_DIR</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">kumagai</span><span class="o">/</span><span class="n">potcars</span><span class="o">/</span>
</pre></div>
</div>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, <code class="code docutils literal notranslate"><span class="pre">PMG_MAPI_KEY</span></code> is required for querying
<code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> files and total energies for competing materials.</p>
<p>Input files for optimizing a unitcell using the PBEsol functional
are generated by the following command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">vasp_set</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span>
</pre></div>
</div>
<p>where <code class="code docutils literal notranslate"><span class="pre">vasp_set</span></code>, or its abbreviation <code class="code docutils literal notranslate"><span class="pre">vs</span></code>,
is a sub-command option of the <code class="code docutils literal notranslate"><span class="pre">vise</span></code> main function.
Similarly, all the sub-commands have their own abbreviations
in <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> and <code class="code docutils literal notranslate"><span class="pre">vise</span></code>.
Here, the PBE functional is a default in <code class="code docutils literal notranslate"><span class="pre">vise</span></code>,
so we use the <code class="code docutils literal notranslate"><span class="pre">-x</span></code> argument to switch the XC functional to PBEsol.</p>
<p>There are also many arguments for each sub-command.
One can always refer its help with the <code class="code docutils literal notranslate"><span class="pre">-h</span></code> argument,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">vs</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>for details.</p>
<p>Note that the structure optimization must be generally iterated with 1.3 times larger
cutoff energy until the forces and stresses converge at the first ionic step.
See, <a class="reference external" href="https://www.vasp.at/wiki/index.php/Energy_vs_volume_Volume_relaxations_and_Pulay_stress">vasp manual</a> for details.
Such iteration of the vasp calculations is not supported by <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>,
but one can easily write the simple runshell scripts to do so.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, users can control various default parameters
as <code class="code docutils literal notranslate"><span class="pre">vise.yaml</span></code> file in <code class="code docutils literal notranslate"><span class="pre">vise</span></code>.
See the <a class="reference external" href="https://kumagai-group.github.io/vise/">document of vise</a> for details.</p>
</div>
<div class="section" id="calculation-of-band-dos-and-dielectric-tensor">
<h2>2. Calculation of band, DOS, and dielectric tensor<a class="headerlink" href="#calculation-of-band-dos-and-dielectric-tensor" title="Permalink to this headline">¶</a></h2>
<p>We then calculate the band structure (BS), density of states (DOS), and dielectric constant.
In the defect calculations, the BS and DOS are used for determining
the valence band maximum (VBM) and conduction band minimum (CBM),
while the static dielectric constant, or a sum of ion-clamped and ionic dielectric tensors,
is needed for correcting the defect formation energies.</p>
<p>First, we create <code class="code docutils literal notranslate"><span class="pre">band/</span></code>, <code class="code docutils literal notranslate"><span class="pre">dos/</span></code> and <code class="code docutils literal notranslate"><span class="pre">dielectric/</span></code> in <code class="code docutils literal notranslate"><span class="pre">unitcell/</span></code>
and copy <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> from <code class="code docutils literal notranslate"><span class="pre">unitcell/structure_opt/</span></code>
and type the following command in each directory,</p>
<p>:</p>
<blockquote>
<div><p>vise vs -x pbesol -t &lt;band, dos or dielectric_dfpt&gt;</p>
</div></blockquote>
<p><code class="code docutils literal notranslate"><span class="pre">Vise</span></code> also provides the plotters for BS and DOS.
See the <a class="reference external" href="https://kumagai-group.github.io/vise/">document of vise</a> for details.</p>
</div>
<div class="section" id="gathering-unitcell-information-related-to-point-defect-calculations">
<h2>3. Gathering unitcell information related to point-defect calculations<a class="headerlink" href="#gathering-unitcell-information-related-to-point-defect-calculations" title="Permalink to this headline">¶</a></h2>
<p>We next collect the bulk information,
namely the band edges and ion-clamped and ionic dielectric tensors
using the <code class="code docutils literal notranslate"><span class="pre">unitcell</span></code> (= <code class="code docutils literal notranslate"><span class="pre">u</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">u</span> <span class="o">--</span><span class="n">vasprun_band</span> <span class="n">band</span><span class="o">/</span><span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span> <span class="o">--</span><span class="n">outcar_band</span> <span class="n">band</span><span class="o">/</span><span class="n">OUTCAR</span> <span class="o">--</span><span class="n">outcar_dielectric_clamped</span> <span class="n">dielectric</span><span class="o">/</span><span class="n">OUTCAR</span> <span class="o">--</span><span class="n">outcar_dielectric_ionic</span> <span class="n">dielectric</span><span class="o">/</span><span class="n">OUTCAR</span>
</pre></div>
</div>
<p>Here, the ion-clamped and ionic dielectric constants can be set
with different <code class="code docutils literal notranslate"><span class="pre">OUTCAR</span></code> files.
Then, <code class="code docutils literal notranslate"><span class="pre">unitcell.json</span></code> is generated, which will be used for analyzing defect calculations later.
Generally, json files are less readable, so we implement <code class="code docutils literal notranslate"><span class="pre">print</span></code> (= <code class="code docutils literal notranslate"><span class="pre">p</span></code>)
sub-command to generate readable command line output from json files, which can be used as follows,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">p</span> <span class="o">-</span><span class="n">f</span> <span class="n">unitcell</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>where the unitcell information is shown as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Unitcell</span><span class="p">(</span><span class="n">vbm</span><span class="o">=</span><span class="mf">0.5461</span><span class="p">,</span> <span class="n">cbm</span><span class="o">=</span><span class="mf">3.0807</span><span class="p">,</span> <span class="n">ele_dielectric_const</span><span class="o">=</span><span class="p">[[</span><span class="mf">4.645306</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.645306</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.645306</span><span class="p">]],</span> <span class="n">ion_dielectric_const</span><span class="o">=</span><span class="p">[[</span><span class="mf">2.584237</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.584192</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.584151</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="section" id="calculation-of-competing-phases">
<h2>4. Calculation of competing phases<a class="headerlink" href="#calculation-of-competing-phases" title="Permalink to this headline">¶</a></h2>
<p>When a defect is introduced, atoms are exchanged with the hypothetical atomic
reservoirs within the thermodynamics framework.
To calculate a free energy of defect formation that is approximated
with the defect formation energy in most cases,
we need to determine atom’s chemical potentials associate with creating the defect.
Usually, we consider the chemical potentials at the condition
where competing phases coexist with the host material,
which are determined from the chemical potential diagram.</p>
<p>For this purpose, we create directories in <code class="code docutils literal notranslate"><span class="pre">competing_phases/</span></code>.
We can retrieve POSCARs of the stable or slightly unstable competing phases
from <a class="reference external" href="https://materialsproject.org">the Materials Project (MP)</a>.
For this purpose, one needs <a class="reference external" href="https://materialsproject.org/open">the API keys</a>
of the MP as mentioned above.
Here, we obtain the competing materials with MgSe whose energies above hull are less than 0.5 meV/atom using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">mp</span> <span class="o">-</span><span class="n">e</span> <span class="n">Mg</span> <span class="n">Se</span> <span class="o">--</span><span class="n">e_above_hull</span> <span class="mf">0.0005</span>
</pre></div>
</div>
<p>This command creates the following directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Mg149Se_mp</span><span class="o">-</span><span class="mi">1185632</span><span class="o">/</span> <span class="n">MgSe_mp</span><span class="o">-</span><span class="mi">13031</span><span class="o">/</span> <span class="n">Mg_mp</span><span class="o">-</span><span class="mi">1094122</span><span class="o">/</span> <span class="n">Se_mp</span><span class="o">-</span><span class="mi">570481</span><span class="o">/</span>
</pre></div>
</div>
<p>In each directory, there are <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> and <code class="code docutils literal notranslate"><span class="pre">prior_info.yaml</span></code>.
The <code class="code docutils literal notranslate"><span class="pre">prior_info.yaml</span></code> contains the some information in the Materials Project database,
which is useful for determining the first-principles calculation conditions.</p>
<p>For example, <code class="code docutils literal notranslate"><span class="pre">Mg_mp-1094122/prior_info.yaml</span></code> is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">band_gap</span><span class="p">:</span> <span class="mf">0.0</span>
<span class="n">data_source</span><span class="p">:</span> <span class="n">mp</span><span class="o">-</span><span class="mi">1094122</span>
<span class="n">total_magnetization</span><span class="p">:</span> <span class="mf">0.00010333333333333333</span>
</pre></div>
</div>
<p>which means Mg is a non-magnetic metallic system.
<code class="code docutils literal notranslate"><span class="pre">Vise</span></code> parses the <code class="code docutils literal notranslate"><span class="pre">prior_info.yaml</span></code>
and determines the k-point density in <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code>
and spin polarization via <code class="code docutils literal notranslate"><span class="pre">ISPIN</span></code> tag in <code class="code docutils literal notranslate"><span class="pre">INCAR</span></code>.</p>
<p>Note that O<sub>2</sub>, H<sub>2</sub>, N<sub>2</sub>, NH<sub>3</sub>, and NO<sub>2</sub> molecules
are not retrieved from MP but created by <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>
since these molecules have been calculated as solids in MP,
which could be inadequate for competing phases for the defect calculations.</p>
<p>We then generate <code class="code docutils literal notranslate"><span class="pre">INCAR</span></code>, <code class="code docutils literal notranslate"><span class="pre">POTCAR</span></code>, <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code>
files for competing solids and molecules.
Note, we need to use the <strong>common cutoff energy</strong>, <code class="code docutils literal notranslate"><span class="pre">ENCUT</span></code>, for comparing the total energies,
which is increased to 1.3 times of <strong>max</strong> <code class="code docutils literal notranslate"><span class="pre">ENMAX</span></code> between the constituent POTCARs.
In case of MgSe, <code class="code docutils literal notranslate"><span class="pre">ENMAX</span></code> of Mg and O are 200.0 and 211.555 eV,
so we need to set <code class="code docutils literal notranslate"><span class="pre">ENCUT</span> <span class="pre">=</span> <span class="pre">275.022</span></code>, using the <code class="code docutils literal notranslate"><span class="pre">vise</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in *_*/;do cd $i; vise vs -uis ENCUT 275.022 -x pbesol ; cd ../;done
</pre></div>
</div>
<p>The target material, namely MgSe in this example, has already been calculated,
so we do not have to iterate the same calculations;
instead make a symbolic link by <code class="code docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">../unitcell/structure_opt</span> <span class="pre">MgSe</span></code>
after removing <code class="code docutils literal notranslate"><span class="pre">MgSe_mp-13031/</span></code>.
However, if we calculate it with different <code class="code docutils literal notranslate"><span class="pre">ENMAX</span></code> to be
consistent with larger <code class="code docutils literal notranslate"><span class="pre">ENMAX</span></code> of dopant atoms,
we need to calculate it again.</p>
<p>Note also that, if competing phases are gases, we need to change
<code class="code docutils literal notranslate"><span class="pre">ISIF</span></code> to 2 so as not to relax the lattice constants
(see <a class="reference external" href="https://cms.mpi.univie.ac.at/wiki/index.php/ISIF">[vasp manual]</a>),
and <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code> to the Gamma point sampling.
This is, however, automatically tuned with <code class="code docutils literal notranslate"><span class="pre">vise</span></code> via <code class="code docutils literal notranslate"><span class="pre">prior_info.yaml</span></code>.</p>
<p>After finishing the vasp calculations,
we can generate the json file for the chemical potential diagram with
the <code class="code docutils literal notranslate"><span class="pre">make_cpd</span></code> (= <code class="code docutils literal notranslate"><span class="pre">mcpd</span></code>) sub-command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">mcpd</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span>
</pre></div>
</div>
<p>When renaming the <code class="code docutils literal notranslate"><span class="pre">vasprun.xml</span></code> and <code class="code docutils literal notranslate"><span class="pre">OUTCAR</span></code> files to e.g.,
<code class="code docutils literal notranslate"><span class="pre">vasprun-finish.xml</span></code> and <code class="code docutils literal notranslate"><span class="pre">OUTCAR-finish</span></code>,
one needs to write the following in the <code class="code docutils literal notranslate"><span class="pre">pydefect.yaml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># VASP file names</span>
<span class="n">outcar</span><span class="p">:</span> <span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span>
<span class="n">vasprun</span><span class="p">:</span> <span class="n">vasprun</span><span class="o">-</span><span class="n">finish</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>To plot the chemical potential diagram,
use the <code class="code docutils literal notranslate"><span class="pre">plot_cpd</span></code> (= <code class="code docutils literal notranslate"><span class="pre">pcpd</span></code>) sub-command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">pcpd</span> <span class="o">-</span><span class="n">y</span> <span class="n">cpd</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>which depicts the Mg-O chemical potential diagram that is also saved as <code class="code docutils literal notranslate"><span class="pre">cpd.pdf</span></code>.
The binary and ternary chemical potential diagrams look like</p>
<img alt="_images/cpd_MgO.png" src="_images/cpd_MgO.png" />
<img alt="_images/cpd_BaSnO3.png" src="_images/cpd_BaSnO3.png" />
<p>Here, relative chemical potentials at the vertices are also shown as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----+---------+--------+---------+</span>
<span class="o">|</span>    <span class="o">|</span>   <span class="n">mu_Ba</span> <span class="o">|</span>   <span class="n">mu_O</span> <span class="o">|</span>   <span class="n">mu_Sn</span> <span class="o">|</span>
<span class="o">|----+---------+--------+---------|</span>
<span class="o">|</span> <span class="n">A</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">5.927</span> <span class="o">|</span>  <span class="mi">0</span>     <span class="o">|</span>  <span class="o">-</span><span class="mf">4.966</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">B</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">5.581</span> <span class="o">|</span>  <span class="mi">0</span>     <span class="o">|</span>  <span class="o">-</span><span class="mf">5.312</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">C</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">3.124</span> <span class="o">|</span> <span class="o">-</span><span class="mf">2.59</span>  <span class="o">|</span>   <span class="mi">0</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">D</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">5.352</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.114</span> <span class="o">|</span>  <span class="o">-</span><span class="mf">5.198</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">E</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">2.753</span> <span class="o">|</span> <span class="o">-</span><span class="mf">2.713</span> <span class="o">|</span>   <span class="mi">0</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">F</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">3.558</span> <span class="o">|</span> <span class="o">-</span><span class="mf">2.37</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">0.226</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">G</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">3.503</span> <span class="o">|</span> <span class="o">-</span><span class="mf">2.4</span>   <span class="o">|</span>  <span class="o">-</span><span class="mf">0.189</span> <span class="o">|</span>
<span class="o">+----+---------+--------+---------+</span>
</pre></div>
</div>
<p>If one needs to modify the energies for the chemical potential diagram,
one can directly modify the <code class="code docutils literal notranslate"><span class="pre">vertices_MgO.yaml</span></code> file.</p>
<p>Calculations of the competing phases are often laborious,
and sometimes we wants to roughly check the defect formation energies as soon as possible.
<code class="code docutils literal notranslate"><span class="pre">Pydefect</span></code> supports to create the chemical potential diagram
from the Materials Project database.
To do this, however, one needs to prepare atom energies
that are needed to align the element energy standards.</p>
<p>With <code class="code docutils literal notranslate"><span class="pre">vise</span></code>, we can easily prepare atom calculation directories.
Here, we show an example of BaSnO<sub>3</sub>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="nb">map</span> <span class="o">-</span><span class="n">e</span> <span class="n">K</span> <span class="n">Al</span> <span class="n">Si</span> <span class="n">O</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pydefect mcpd -e Ba Sn O -t BaSnO3 -f $PYDEFECT_PATH/pydefect/chem_pot_diag/datasets/vise_pbe_vasp544_atom_energy.yaml
</pre></div>
</div>
<p>However, we are not sure if the atom energies are always the same
when using the same vasp version and PAW potential,
so we strongly recommend the researchers to calculate atom energies by themselves.</p>
</div>
<div class="section" id="construction-of-a-supercell-and-defect-initial-setting-file">
<h2>5. Construction of a supercell and defect initial setting file<a class="headerlink" href="#construction-of-a-supercell-and-defect-initial-setting-file" title="Permalink to this headline">¶</a></h2>
<p>We have finished the calculations of the unit cell and competing phases, and are eventually ready for point-defect calculations.
Let’s create <code class="code docutils literal notranslate"><span class="pre">defect/</span></code> directory and copy unitcell <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> file from e.g. <code class="code docutils literal notranslate"><span class="pre">unitcell/dos/</span></code> to <code class="code docutils literal notranslate"><span class="pre">defect/</span></code></p>
<p>We then create a supercell and defect-type related files with the <code class="code docutils literal notranslate"><span class="pre">supercell</span></code> (= <code class="code docutils literal notranslate"><span class="pre">s</span></code>) and <code class="code docutils literal notranslate"><span class="pre">defect_set</span></code> (= <code class="code docutils literal notranslate"><span class="pre">ds</span></code>) sub-commands.
<code class="code docutils literal notranslate"><span class="pre">Pydefect</span></code> recommends a nearly isotropic (and sometimes cubic-like) supercell composed of moderate number of atoms.
With the following command, one can create <code class="code docutils literal notranslate"><span class="pre">SPOSCAR</span></code> file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span>
</pre></div>
</div>
<p>If the input structure is different from the standardized primitive cell, <code class="code docutils literal notranslate"><span class="pre">NotPrimitiveError</span></code> is raised.</p>
<p>At present, <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> constructs the supercell by expanding the <em>conventional</em> unitcell isotropically.</p>
<p>It is possible to change the lattice angle of the supercell from those of the conventional unitcell.
For example, we can make a supercell in which a-, b-, and c-axes are mutually orthogonal for hexagonal systems.
However, it is not a good idea for point-defect calculations because such lattice breaks the original symmetry,
which reduces the accuracy of the point-defect calculations and makes it difficult to analyze the defect site symmetry.
One exception in <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> is the tetragonal cell,
where rotated supercells by 45 degrees are allowed with keeping the symmetry.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, a user can also specify the cell matrix, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span> <span class="o">--</span><span class="n">matrix</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The matrix is applied to the conventional cell. If one wants to know the conventional cell, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span> <span class="o">--</span><span class="n">matrix</span> <span class="mi">1</span>
</pre></div>
</div>
<p>See the help for more details.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code> file contains the full information on the supercell,
which can be seen by using the <code class="code docutils literal notranslate"><span class="pre">-p</span></code> option.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Space</span> <span class="n">group</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="mi">43</span><span class="n">m</span>
<span class="n">Transformation</span> <span class="n">matrix</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Cell</span> <span class="n">multiplicity</span><span class="p">:</span> <span class="mi">32</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Mg1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">a</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
         <span class="n">Cutoff</span> <span class="n">radius</span><span class="p">:</span> <span class="mf">3.373</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Se&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">]}</span>
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">0.</span><span class="o">.</span><span class="mi">31</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">1.31</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">2</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Se1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">c</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
         <span class="n">Cutoff</span> <span class="n">radius</span><span class="p">:</span> <span class="mf">3.373</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">]}</span>
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">32.</span><span class="o">.</span><span class="mi">63</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.1250000</span>  <span class="mf">0.1250000</span>  <span class="mf">0.1250000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">2.55</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span>
</pre></div>
</div>
<p>With the <code class="code docutils literal notranslate"><span class="pre">defect_set</span></code> (= <code class="code docutils literal notranslate"><span class="pre">ds</span></code>) sub-command, we can build the <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code> file.
An example of <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code> for MgSe looks as follows,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Mg_Se1</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">Se_Mg1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">Va_Mg1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">Va_Se1</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>where the combination of defect types and their charges are shown.
We can modify this file using an editor if necessary.
If we want to add dopants, we can type as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">-</span><span class="n">d</span> <span class="n">Ca</span>
</pre></div>
</div>
<p>There are some tips related to <code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code> and <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code>.</p>
<p>1. The antisites and substituted defects are determined from the difference of the electronegativity between the substituted and removed atoms.
Default max difference is written in <code class="code docutils literal notranslate"><span class="pre">defaults.py</span></code>, but you can change it via <code class="code docutils literal notranslate"><span class="pre">pydefect.yaml</span></code> as mentioned above.</p>
<p>2. The oxidation states determine the defect charge states.
For instance, the vacancies (interstitials) of Sn<sup>2+</sup> may take 0, -(+)1, or -(+)2,
while those of Sn<sup>4+</sup> between 0 and -(+)4 charge states.
For the antisites and substituted defects,
<code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> considers all the possible combinations of vacancies and interstitials.
So, for example, Sn<sup>2+</sup> -on-S<sup>2-</sup> takes 0, +1, +2, +3, and +4 charge states.
The oxidation states are determined using the <code class="code docutils literal notranslate"><span class="pre">oxi_state_guesses</span></code> method of
<code class="code docutils literal notranslate"><span class="pre">Composition</span></code> class in <code class="code docutils literal notranslate"><span class="pre">pymatgen</span></code>.
The users can also manually set the oxidation states as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">--</span><span class="n">oxi_states</span> <span class="n">Mg</span> <span class="mi">4</span>
</pre></div>
</div>
<p>However, the range of the charge state may not be enough in some cases.
For instance, the Zn vacancies in ZnO are known to show the +1 charge state
because they can capture multiple polarons at the neighboring O sites.
See <a class="reference external" href="journals.aps.org/prb/abstract/10.1103/PhysRevB.95.094105">Frodason et al., Phys. Rev. B (2017)</a>
Users have to add these outliers by themselves.</p>
<p>3. By default, positions of atoms neighboring a defect are perturbed
such that the symmetry is lowered to P1.
This is, however, unwanted in some cases because it increases the number of irreducible k-points
Then, <code class="code docutils literal notranslate"><span class="pre">displace_distance</span></code> needs to be set to 0 via <code class="code docutils literal notranslate"><span class="pre">pydefect.yaml</span></code>.</p>
<p>4. If you want to calculate particular defects e.g., only oxygen vacancies,
you can restrict the calculated defects with <code class="code docutils literal notranslate"><span class="pre">-k</span></code> option and a python regular expression,
For example, when typing as follows,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">-</span><span class="n">k</span> <span class="s2">&quot;Va_O[0-9]?_[0-9]+&quot;</span>
</pre></div>
</div>
<p>these directories are created.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">perfect</span><span class="o">/</span> <span class="n">Va_O1_0</span><span class="o">/</span> <span class="n">Va_O1_1</span><span class="o">/</span> <span class="n">Va_O1_2</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="decision-of-interstitial-sites">
<h2>6. Decision of interstitial sites<a class="headerlink" href="#decision-of-interstitial-sites" title="Permalink to this headline">¶</a></h2>
<p>In addition to vacancies and antisites, one may want to take into account the interstitials.
Most people determine them by seeing the host crystal structures,
while there are a couple of procedures that recommend the interstitial sites.
However, it is generally not an easy task to speculate the most likely interstitial sites
because they depend on the substituted element.</p>
<p>The largest vacant space should be most likely interstitial sites
for positively charged cations with closed shells are substituted (e.g., Mg<sup>2+</sup>, Al<sup>3+</sup>),
as they tend not to make strong bonding with other atoms.
On the other hand, a proton (H<sup>+</sup>) prefers to locate near O<sup>2-</sup> or N<sup>3-</sup>
to form the strong O-H or N-H bonding.
Conversely, a hydride ion (H<sup>-</sup>) should prefer to locate at very much different places.
Therefore, we need to carefully determine the interstitial sites.</p>
<p><code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> holds a utility that recommends the interstitial sites based on
the all electron charge density in the unitcell
using the <code class="code docutils literal notranslate"><span class="pre">ChargeDensityAnalyzer</span></code> class implemented in <code class="code docutils literal notranslate"><span class="pre">pymatgen</span></code>.
To use this, we need to generate <code class="code docutils literal notranslate"><span class="pre">AECCAR0</span></code> and <code class="code docutils literal notranslate"><span class="pre">AECCAR2</span></code>
based on the standardized primitive cell.</p>
<p>It is also fine to add this task at the DOS calculations.
The command of <code class="code docutils literal notranslate"><span class="pre">vise</span></code> for this is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">vs</span> <span class="o">-</span><span class="n">uis</span> <span class="n">LAECHG</span> <span class="kc">True</span> <span class="o">-</span><span class="n">t</span> <span class="n">dos</span>
</pre></div>
</div>
<p>This should not be done at the BS calculations, because the primitive cells
may be different from the standardized primitive cell in particular space groups.</p>
<p>After running the vasp calculation, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_FILE/recommend_interstitials.py AECCAR0 AECCAR2
</pre></div>
</div>
<p>, which shows the local minimum points of the charge density as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>          <span class="n">a</span>         <span class="n">b</span>         <span class="n">c</span>  <span class="n">Charge</span> <span class="n">Density</span>
<span class="mi">0</span>  <span class="mf">0.750000</span>  <span class="mf">0.750000</span>  <span class="mf">0.750000</span>        <span class="mf">0.527096</span>
<span class="mi">1</span>  <span class="mf">0.500000</span>  <span class="mf">0.500000</span>  <span class="mf">0.500000</span>        <span class="mf">0.669109</span>
<span class="mi">2</span>  <span class="mf">0.611111</span>  <span class="mf">0.611111</span>  <span class="mf">0.166667</span>        <span class="mf">1.020380</span>
<span class="mi">3</span>  <span class="mf">0.166667</span>  <span class="mf">0.611111</span>  <span class="mf">0.611111</span>        <span class="mf">1.020382</span>
<span class="mi">4</span>  <span class="mf">0.611111</span>  <span class="mf">0.166667</span>  <span class="mf">0.611111</span>        <span class="mf">1.020382</span>
<span class="n">Host</span> <span class="n">symmetry</span> <span class="n">R3m</span>
<span class="o">++</span> <span class="n">Inequivalent</span> <span class="n">indices</span> <span class="ow">and</span> <span class="n">site</span> <span class="n">symmetries</span> <span class="o">++</span>
  <span class="mi">0</span>   <span class="mf">0.7500</span>   <span class="mf">0.7500</span>   <span class="mf">0.7500</span> <span class="mi">3</span><span class="n">m</span>
  <span class="mi">1</span>   <span class="mf">0.5000</span>   <span class="mf">0.5000</span>   <span class="mf">0.5000</span> <span class="mi">3</span><span class="n">m</span>
  <span class="mi">2</span>   <span class="mf">0.6111</span>   <span class="mf">0.6111</span>   <span class="mf">0.1667</span> <span class="o">.</span><span class="n">m</span>
</pre></div>
</div>
<p>Note, again, that the local minimum points may not be the best initial points
for some particular interstitials,
so users must need to recognize the limit of this procedure.</p>
<p>To add the interstitial site at e.g., 0.75  0.75  0.75,
we use the <code class="code docutils literal notranslate"><span class="pre">interstitial</span></code> (= <code class="code docutils literal notranslate"><span class="pre">i</span></code>) sub-command like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ai</span> <span class="o">-</span><span class="n">s</span> <span class="n">supercell_info</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">p</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">structure_opt</span><span class="o">/</span><span class="n">POSCAR</span> <span class="o">-</span><span class="n">c</span> <span class="mf">0.75</span> <span class="mf">0.75</span> <span class="mf">0.75</span>
</pre></div>
</div>
<p><code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code> is then updated,
which includes the information of the interstitial sites.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">--</span> <span class="n">interstitials</span>
<span class="c1">#1</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.3750000</span>  <span class="mf">0.3750000</span>  <span class="mf">0.3750000</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">c</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">],</span> <span class="s1">&#39;Se&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]}</span>
</pre></div>
</div>
<p>If we want to add another site at e.g. 0.5 0.5 0.5 ,
<code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code> is again updated.</p>
<p>To pop the interstitial sites, use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">pi</span> <span class="o">-</span><span class="n">i</span> <span class="mi">1</span> <span class="o">-</span><span class="n">s</span> <span class="n">supercell_info</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>The first interstitial locating at (0.75, 0.75, 0.75) is removed from <code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code>.</p>
</div>
<div class="section" id="creation-of-defect-calculation-directories">
<h2>7. Creation of defect calculation directories<a class="headerlink" href="#creation-of-defect-calculation-directories" title="Permalink to this headline">¶</a></h2>
<p>We next create directories for point-defect calculations with the <code class="code docutils literal notranslate"><span class="pre">defect_entries</span></code> (= <code class="code docutils literal notranslate"><span class="pre">de</span></code>) sub-command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">de</span>
</pre></div>
</div>
<p>With this command, defect calculation directories are created, including <code class="code docutils literal notranslate"><span class="pre">perfect/</span></code>.</p>
<p>If you again type the same command, the following information appears,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2020</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">24</span> <span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">27</span>    <span class="n">INFO</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">main_function</span>
 <span class="o">--&gt;</span> <span class="n">perfect</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">24</span> <span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">27</span>    <span class="n">INFO</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">main_function</span>
 <span class="o">--&gt;</span> <span class="n">Va_Se1_1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">24</span> <span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">27</span>    <span class="n">INFO</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">main_function</span>
 <span class="o">--&gt;</span> <span class="n">Va_Se1_2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">24</span> <span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">27</span>    <span class="n">INFO</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">main_function</span>
 <span class="o">--&gt;</span> <span class="n">Va_Se1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="o">...</span>
</pre></div>
</div>
<p>and no directories are newly created.
This is a fail-safe treatment so as not to delete the calculated directories by mistake.
If you really want to recreate the directories, you need to remove directories first.</p>
<p>In each directory, one can find the <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code> file,
which contains information about a point defect obtained
before running the first-principles calculations.
To see <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code>, again use the <code class="code docutils literal notranslate"><span class="pre">-p</span></code> option.</p>
<p>When you’d like to add some particular defects,
you can modify the <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code> and type the <code class="code docutils literal notranslate"><span class="pre">de</span></code> option again.</p>
</div>
<div class="section" id="generation-of-defect-entry-json">
<h2>8. Generation of defect_entry.json<a class="headerlink" href="#generation-of-defect-entry-json" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, one may want to treat complex defects.
For instance, O<sub>2</sub> molecules act as anions in MgO<sub>2</sub>,
where O<sub>2</sub> molecule vacancies are able to exist.
Other important examples are the methylammonium lead halides (MAPI),
where methylammonium ions acts
as singly positive cations (CH<sub>3</sub>NH<sub>3</sub><sup>+</sup>), and DX centers,
where anion vacancies and interstitial cations coexist.</p>
<p>In these cases, one needs to prepare the input files and runs the vasp calculations by oneself.
However, <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> necessitates the <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code> file for the postprocess,
which cannot be easily generated by the users.</p>
<p>In aid of this, <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> provides the <code class="code docutils literal notranslate"><span class="pre">create_defect_entry.py</span></code>,
which parses the <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> files and defect name as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_FILE/create_defect_entry.py complex_2 complex_2/POSCAR perfect/POSCAR
</pre></div>
</div>
<p>which creates the <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code> file. The name is then parsed as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A_B_C</span> <span class="o">-&gt;</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A_B&#39;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">C</span>
</pre></div>
</div>
<p>This script can be used when one wants to use <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>
for analyzing the defect calculations in progress.</p>
</div>
<div class="section" id="parsing-supercell-calculation-results">
<h2>9. Parsing supercell calculation results<a class="headerlink" href="#parsing-supercell-calculation-results" title="Permalink to this headline">¶</a></h2>
<p>Then, let’s run the vasp calculations.</p>
<p>We recommend the users to use the Gamma version of vasp
if the k point is sampled only at the Gamma point for large supercells.</p>
<p>After (partly) finishing the vasp calculations,
we can generate the <code class="code docutils literal notranslate"><span class="pre">calc_results.json</span></code> that contains
the first-principles calculation results related to the defect properties.</p>
<p>By using the <code class="code docutils literal notranslate"><span class="pre">calc_results</span></code> (= <code class="code docutils literal notranslate"><span class="pre">cr</span></code>) sub-command,
we can generate <code class="code docutils literal notranslate"><span class="pre">calc_results.json</span></code> in all the calculated directories.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">cr</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="n">perfect</span>
</pre></div>
</div>
<p>When one wants to generate <code class="code docutils literal notranslate"><span class="pre">calc_results.json</span></code>
for some particular directories, e.g., Va_O1_0, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">cr</span> <span class="o">-</span><span class="n">d</span> <span class="n">Va_O1_0</span>
</pre></div>
</div>
</div>
<div class="section" id="corrections-of-defect-formation-energies-in-finite-size-supercells">
<h2>10. Corrections of defect formation energies in finite-size supercells<a class="headerlink" href="#corrections-of-defect-formation-energies-in-finite-size-supercells" title="Permalink to this headline">¶</a></h2>
<p>When the supercell method is adopted under the periodic boundary condition,
the total energies for <strong>charged defects</strong> are not properly estimated
due to interactions between a defect, its images, and background charge.
Therefore, we need to correct the total energies of the charged defect supercells
to those in the dilution limit.</p>
<p>The corrections are performed using the
<code class="code docutils literal notranslate"><span class="pre">extended_fnv_correction</span></code> (= <code class="code docutils literal notranslate"><span class="pre">efnv</span></code>) sub-command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">efnv</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">u</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>For the corrections, we need the static dielectric constants
and atomic site potentials in the perfect supercell.
Therefore, the paths to <code class="code docutils literal notranslate"><span class="pre">unitcell.json</span></code> and <code class="code docutils literal notranslate"><span class="pre">calc_results.json</span></code>
files must be assigned.
Bear also in mind that this command takes some time.</p>
<p>The correction in <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> at this moment is now performed with
the so-called extended Freysoldt-Neugebauer-Van de Walle (eFNV) method.
If one uses the corrections, please cite the following papers.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.102.016402">C. Freysoldt, J. Neugebauer, and C. Van de Walle, Fully Ab Initio Finite-Size Corrections for Charged-Defect Supercell Calculations, Phys. Rev. Lett., 102 016402 (2009).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.89.195205">Y. Kumagai* and F. Oba, Electrostatics-based finite-size corrections for first-principles point defect calculations, Phys. Rev. B, 89 195205 (2014).</a></p></li>
</ul>
<p>One obtains <code class="code docutils literal notranslate"><span class="pre">correction.pdf</span></code> file, which contains information
about defect-induced and point-charge potential,
and their differences at atomic sites as shown below.</p>
<img alt="_images/correction_pdf_MgSe_Va_Mg_2.png" src="_images/correction_pdf_MgSe_Va_Mg_2.png" />
<p>The height of the horizontal line indicates the averaged potential difference
between the point-charge potential and that caused by the defect,
namely potential in the defective supercell minus that in the perfect supercell.
The range of the line means the averaged region. See
<a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.89.195205">Y. Kumagai* and F. Oba (2014)</a>
for details.</p>
<p>When performing the corrections, I strongly recommend you to check
all the <code class="code docutils literal notranslate"><span class="pre">correction.pdf</span></code> files for the calculated defects
so as to reduce careless mistakes as much as possible.</p>
</div>
<div class="section" id="check-defect-eigenvalues-and-band-edge-states-in-supercell-calculations">
<h2>11. Check defect eigenvalues and band-edge states in supercell calculations<a class="headerlink" href="#check-defect-eigenvalues-and-band-edge-states-in-supercell-calculations" title="Permalink to this headline">¶</a></h2>
<p>Generally, point defects are divided into three types.</p>
<p>(1) Defects with deep localized states inside the band gap.
This type of defect is generally considered to be detrimental
for device performances as the carriers are trapped by the localized states.
Furthermore, they could act as color centers, as represented by the vacancies in NaCl.
Therefore, it is important to know the position of the localized state and its origin.</p>
<p>(2) Defects with hydrogenic carrier states, or perturbed host states (PHS),
where carriers locate at the band edges with loosely trapped by the charged defect centers.
Examples are the B-on-Si (p-type) and P-on-Si (n-type) substitutional dopants in Si.
These defects also do little harm for device performances,
but introduce the carrier electrons/holes or kill counter carriers.
The wavefunctions of the PHS widespread to several million atoms.
Therefore, to calculate their thermodynamical transition levels,
we need supergiant supercell calculations,
which are almost prohibitive with first-principles calculations thus far.
Therefore, we instead usually avoid calculating these quantities and
denote that the defects have PHS and their transition energies locate near band edges only qualitatively.</p>
<p>(3) Defects without any defect states inside the band gap or near the band edges,
which would not largely affect the electronic properties
as long as their concentrations are not exceedingly high.</p>
<p>See some examples from our published papers.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://link.aps.org/pdf/10.1103/PhysRevB.90.125202">Y. Kumagai*, M. Choi, Y. Nose, and F. Oba, First-principles study of point defects in chalcopyrite ZnSnP2, Phys. Rev. B, 90 125202 (2014).</a></p></li>
<li><p><a class="reference external" href="https://link.aps.org/doi/10.1103/PhysRevApplied.6.014009">Y. Kumagai*, L. A. Burton, A. Walsh, and F. Oba, Electronic structure and defect physics of tin sulfides: SnS, Sn2S3, and SnS2, Phys. Rev. Applied, 6 014009 (2016).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.8.014015)">Y. Kumagai*, K. Harada, H. Akamatsu, K. Matsuzaki, and F. Oba, Carrier-Induced Band-Gap Variation and Point Defects in Zn3N2 from First Principles, Phys. Rev. Applied, 8 014015 (2017).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.9.034019">Y. Kumagai*, N. Tsunoda, and F. Oba, Point defects and p-type doping in ScN from first principles, Phys. Rev. Applied, 9 034019 (2018).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.10.011001">N. Tsunoda, Y. Kumagai*, A. Takahashi, and F. Oba, Electrically benign defect behavior in ZnSnN2 revealed from first principles, Phys. Rev. Applied, 10 011001 (2018).</a></p></li>
</ul>
<p>To distinguish these three defect types, one needs to look see the defect levels
and judge if the defects create the PHS and/or defect localized states.</p>
<p><code class="code docutils literal notranslate"><span class="pre">Pydefect</span></code> shows the eigenvalues and band-edge states by the following steps.</p>
<p>Firstly, one can generate the <code class="code docutils literal notranslate"><span class="pre">band_edge_eigenvalues.json</span></code>
and <code class="code docutils literal notranslate"><span class="pre">eigenvalues.pdf</span></code> files with the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">eig</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">eigenvalues.pdf</span></code> file looks like,</p>
<img alt="_images/eigenvalues_MgSe_Va_Mg_0.png" src="_images/eigenvalues_MgSe_Va_Mg_0.png" />
<p>Here, one can see single-particle levels and their occupation in the spin-up and -down channels.
The x-axis is fractional coordinates of the sampled k points,
while the y-axis in the absolute scale.
Filled circles inside the figures are single particle levels at each k point.</p>
<p>Two horizontal dashed lines indicate
the valence-band maximum and conduction-band minimum in the perfect supercell.
The discrete numbers in the figures mean the band indices,
and the filled red, green, and blue circles mean the occupied,
partially occupied (from 0.1 to 0.9), and unoccupied eigenstates, respectively.</p>
<p>We then generate the <code class="code docutils literal notranslate"><span class="pre">edge_characters.json</span></code> file with the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">edge_characters</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>and analyze the file and show the edge states with this command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">edge_states</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="o">-</span><span class="n">p</span> <span class="n">perfect</span><span class="o">/</span><span class="n">edge_characters</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>which shows as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Mg_i1_0</span>
<span class="n">spin</span> <span class="n">up</span>   <span class="n">Donor</span> <span class="n">PHS</span>
<span class="n">spin</span> <span class="n">down</span> <span class="n">Donor</span> <span class="n">PHS</span>
<span class="o">--</span> <span class="n">Mg_i1_1</span>
<span class="n">spin</span> <span class="n">up</span>   <span class="n">Donor</span> <span class="n">PHS</span>
<span class="n">spin</span> <span class="n">down</span> <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
<span class="o">--</span> <span class="n">Mg_i1_2</span>
<span class="n">spin</span> <span class="n">up</span>   <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
<span class="n">spin</span> <span class="n">down</span> <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
<span class="o">--</span> <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">1</span>
<span class="n">spin</span> <span class="n">up</span>   <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
<span class="n">spin</span> <span class="n">down</span> <span class="n">In</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
<span class="o">--</span> <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">2</span>
<span class="n">spin</span> <span class="n">up</span>   <span class="n">In</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
<span class="n">spin</span> <span class="n">down</span> <span class="n">In</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
<span class="o">--</span> <span class="n">Va_Mg1_0</span>
<span class="n">spin</span> <span class="n">up</span>   <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
<span class="n">spin</span> <span class="n">down</span> <span class="n">In</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
</pre></div>
</div>
<p>There are four states <code class="code docutils literal notranslate"><span class="pre">donor_phs</span></code>, <code class="code docutils literal notranslate"><span class="pre">acceptor_phs</span></code>, <code class="code docutils literal notranslate"><span class="pre">localized_state</span></code>, <code class="code docutils literal notranslate"><span class="pre">no_in_gap</span></code>,
the former two are considered as shallow states, and should be omitted for energy plot.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, these states are determined from the highest occupied and lowest unoccupied eigenvalues
and the similarity of wavefunction of the highest occupied (lowest unoccupied) state and that of the VBM (CBM).</p>
<p>We emphasize that the automatically determined band-edge states could be incorrect
as it is difficult to determine them.
Therefore, please carefully check the band-edge states,
and draw their band-decomposed charge density if the band-edge states are not obvious.</p>
<p>To modify the band-edge states, modify the <code class="code docutils literal notranslate"><span class="pre">band_edge_states.yaml</span></code> file
in each defect directory by hand, which will be parsed when plotting the defect
formation energies.</p>
</div>
<div class="section" id="plot-defect-formation-energies">
<h2>12. Plot defect formation energies<a class="headerlink" href="#plot-defect-formation-energies" title="Permalink to this headline">¶</a></h2>
<p>Here, we show how to plot the defect formation energies.</p>
<p>The plot of the defect formation energies requires multiple information,
namely band edges, chemical potentials of competing phases,
and total energies of perfect and defective supercells.</p>
<p>The defect formation energies are plotted as a function of the Fermi level
with the <code class="code docutils literal notranslate"><span class="pre">plot_energy</span></code> (= <code class="code docutils literal notranslate"><span class="pre">pe</span></code>) sub-command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">e</span> <span class="o">--</span><span class="n">unitcell</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">perfect</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">d</span> <span class="n">Va</span><span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="o">-</span><span class="n">c</span> <span class="o">../</span><span class="n">competing_phases</span><span class="o">/</span><span class="n">cpd</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">l</span> <span class="n">A</span>
</pre></div>
</div>
<p>which shows like,</p>
<img alt="_images/energy_MgSe_A.png" src="_images/energy_MgSe_A.png" />
<p>When changing the condition for chemical potential, namely the position of the vertex in the chemical potential diagram,
use the <code class="code docutils literal notranslate"><span class="pre">-l</span></code> option.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
      
        <a accesskey="n" class="btn btn-neutral float-right" href="first_principles_calc.html" rel="next" title="Tips for first-principles calculations for point defects">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a accesskey="p" class="btn btn-neutral float-left" href="index.html" rel="prev" title="Welcome to pydefect documentation!"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Yu Kumagai

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>